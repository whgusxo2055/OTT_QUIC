# Codex 규칙 (프로젝트 공통 적용)

## 커뮤니케이션
- 모든 질의응답은 한국어로 답변한다.
- 결정/변경 사항은 간단한 이유와 함께 기록한다.

## 코드 스타일
- 언어: C11, 경고 무시 금지(`-Wall -Wextra -Werror -pedantic` 유지).
- 헤더는 선언/타입/매크로만, 구현은 `.c`에 둔다.
- 스레드/네트워크 코드에는 오류 반환값 체크와 로깅을 반드시 추가한다.
- 주석은 “왜/제약/경계조건” 중심으로만 짧게 남긴다.

## 테스트
- `make test`가 최소 단위 검증의 기준이다. 새 기능은 가능하면 단위 테스트를 추가한다.
- 테스트는 외부 의존성을 최소화하고, 타임아웃을 명시해 무한 대기를 방지한다.

## 동시성·네트워크
- 소켓/락은 소유·수명 규칙을 주석 또는 코드로 명확히 표현한다.
- 스레드 생성 시 종료 합류 경로를 마련하고, 타임아웃이나 취소 플래그를 제공한다.
- 네트워크 I/O에는 적절한 타임아웃과 오류 로그를 설정한다.

## 보안
- 암호/인증 관련 기능은 솔트 포함 느린 해시(PBKDF2/bcrypt/Argon2 등) 사용을 기본으로 한다.
- 외부 입력은 길이/형식 검증 후 처리하며, 로그에는 민감 정보를 남기지 않는다.

## 품질 도구
- 정적 분석/포매터: `clang-tidy`와 `clang-format`을 사용하고, 설정이 없으면 Google C 스타일을 기본 준수한다. 포매터 적용 후 diff를 확인하고, 자동 수정이 위험한 경우 수동 반영한다.
- 새 경고 억제는 주석으로 근거를 남기고, 가능한 한 코드 수정으로 해결한다.

## 로그/에러 정책
- 로그 레벨/형식: `[레벨][모듈] 메시지` 형태로 짧게 기록하며, PII/비밀 값은 마스킹 또는 제거한다.
- 에러 코드: 라이브러리 함수는 음수(또는 `-errno`)를 실패로 반환하고, 0을 성공으로 통일한다. 공용 에러 enum을 도입할 경우 헤더에 정의하고 모듈별 매핑을 유지한다.

## 리뷰/PR 체크리스트
- `make test` 실행 결과 첨부, 신규 기능은 단위 테스트 포함 여부 명시.
- 문서(`docs/`, `README.md`, `codex.md`) 업데이트 여부 확인.
- 리스크/경계조건/타임아웃 처리 여부를 요약.

## 관찰성
- 최소한의 헬스체크 엔드포인트 또는 메트릭 훅(예: 수신/송신 패킷 수, 실패 횟수)을 설계 단계에서 정의한다.
- 로그와 메트릭의 키 이름은 영문 소문자+언더스코어로 일관되게 사용한다.

## 프로세스
- 스프린트 진행 시 `docs/SRS.md`와 `docs/DEVELOPMENT_PLAN.md`(plan)을 참고하여 태스크를 정의·우선순위화한다.
- 각 스프린트 종료 시 진행상황을 3줄 요약하여 git 커밋한다.

## 빌드/도구
- 의존성 추가 시 `README.md`와 `Makefile`을 함께 업데이트한다.
- 자동 생성 파일은 커밋하지 않고, 재현 가능한 빌드 명령을 문서화한다.

## 문서
- 사용자/개발자용 문서는 `docs/`에 Markdown으로 저장하고, 변경 시 관련 문서를 갱신한다.
- 새 프로토콜/포맷을 추가할 때는 최소한의 예시와 에러 시나리오를 함께 적는다.

## 커밋 규칙
- 언어: 한국어, 현재형/명령형으로 간결하게 작성한다. (예: “QUIC 핸드셰이크 응답 추가”)
- 한 커밋은 한 주제/태스크에 집중하고, 관련 코드·테스트·문서 업데이트를 함께 포함한다.
- 커밋 메시지는 50자 내외 제목(필수) + 필요한 경우 본문(무엇을/왜)을 추가한다.
- 스프린트 종료 커밋: 진행상황 3줄 요약을 본문에 포함하고, 태그 예시 `[Sprint5]` 등으로 식별 가능하게 한다.
